name: filemaker
services:
  prep: 
    profiles:
      - prep
    build:
      context: ./prep/versions/${VERSION:?}-u${UBUNTU:?}-${PROCESSOR:-amd}
      dockerfile: dockerfile
    image: fms:prep-${VERSION}
    container_name: fms-prep
    hostname: fms-prep
    privileged: true
    volumes:
      - ./versions/${VERSION}-u${UBUNTU}-${PROCESSOR:-amd}:/install
      - ${DATA:-fms}:/opt/FileMaker/FileMaker Server/Data

  fms:
    profiles:
      - live
    image: ${IMAGE:?}:${TAG_PREFIX}${TAG_PREFIX:+-}${VERSION:?}-u${UBUNTU:?}-${PROCESSOR:-amd}
    container_name: fms
    hostname: fms
    privileged: true
    ports:
      # - 80
      # - 443
      # - 2399
      - 5003
      # - 16001
    volumes:
      - ${MOUNT:-fms}:/opt/FileMaker/FileMaker Server/Data

volumes:
  fms: